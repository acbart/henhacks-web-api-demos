<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Crypto API ‚Äî Web API Demos</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<nav>
  <a href="index.html" class="back-link">‚Üê Back to Index</a>
  <span class="nav-title">Web Crypto API</span>
</nav>

<div class="page-header">
  <span class="api-badge">Security</span>
  <h1>Web Crypto API</h1>
  <p>Browser-native cryptography ‚Äî generate secure random numbers, hash data with SHA-256, and encrypt/decrypt text with AES-GCM, all without any library.</p>
</div>

<main>

  <!-- Random bytes -->
  <div class="card">
    <div class="card-header"><span class="icon">üé≤</span><h2>Secure Random Numbers</h2></div>
    <div class="demo-area">
      <div class="btn-group">
        <button class="btn-primary" onclick="genRandom()">Generate 16 Random Bytes</button>
        <button class="btn-outline" onclick="genUUID()">Generate UUID v4</button>
      </div>
      <div class="status-box" id="randomOut">Click a button above.</div>
    </div>
  </div>

  <!-- SHA-256 hash -->
  <div class="card">
    <div class="card-header"><span class="icon">üîë</span><h2>SHA-256 Hash</h2></div>
    <div class="demo-area">
      <div class="field">
        <label for="hashInput">Text to hash:</label>
        <input type="text" id="hashInput" value="Hello, HenHacks!" style="width:100%">
      </div>
      <button class="btn-primary" onclick="hashText()">Hash with SHA-256</button>
      <div class="status-box" id="hashOut" style="word-break:break-all">Result will appear here.</div>
    </div>
  </div>

  <!-- AES-GCM encrypt/decrypt -->
  <div class="card">
    <div class="card-header"><span class="icon">üîí</span><h2>AES-GCM Encrypt / Decrypt</h2></div>
    <div class="demo-area">
      <div class="field">
        <label for="encInput">Plaintext:</label>
        <input type="text" id="encInput" value="Super secret message!" style="width:100%">
      </div>
      <div class="btn-group">
        <button class="btn-primary" onclick="encryptText()">üîí Encrypt</button>
        <button class="btn-accent" onclick="decryptText()">üîì Decrypt</button>
      </div>
      <div class="status-box" id="encOut" style="word-break:break-all">Ciphertext will appear here.</div>
      <div class="status-box" id="decOut">Decrypted text will appear here.</div>
    </div>
  </div>

  <!-- Source code -->
  <div class="card">
    <div class="card-header"><span class="icon">üíª</span><h2>Source Code</h2></div>
    <div class="code-block">
      <pre><code>// ‚îÄ‚îÄ Secure random bytes ‚îÄ‚îÄ
const bytes = crypto.getRandomValues(new Uint8Array(16));
const hex = Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');

// Built-in UUID v4
const uuid = crypto.randomUUID();

// ‚îÄ‚îÄ SHA-256 hash ‚îÄ‚îÄ
async function sha256(message) {
  const data = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// ‚îÄ‚îÄ AES-GCM encrypt / decrypt ‚îÄ‚îÄ
let cryptoKey, iv;

async function encrypt(plaintext) {
  cryptoKey = await crypto.subtle.generateKey(
    { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt']
  );
  iv = crypto.getRandomValues(new Uint8Array(12));
  const encoded = new TextEncoder().encode(plaintext);
  const ciphertext = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv }, cryptoKey, encoded
  );
  return btoa(String.fromCharCode(...new Uint8Array(ciphertext)));
}

async function decrypt(cipherB64) {
  const cipherBytes = Uint8Array.from(atob(cipherB64), c => c.charCodeAt(0));
  const decrypted = await crypto.subtle.decrypt(
    { name: 'AES-GCM', iv }, cryptoKey, cipherBytes
  );
  return new TextDecoder().decode(decrypted);
}</code></pre>
    </div>
  </div>

  <!-- Key facts -->
  <div class="card">
    <div class="card-header"><span class="icon">üí°</span><h2>Key Facts</h2></div>
    <div class="card-body">
      <ul style="padding-left:20px;display:flex;flex-direction:column;gap:8px;font-size:0.9rem;color:var(--text-muted)">
        <li><code>crypto.getRandomValues()</code> is cryptographically secure ‚Äî unlike <code>Math.random()</code>.</li>
        <li><code>crypto.subtle.digest()</code> supports SHA-1, SHA-256, SHA-384, and SHA-512.</li>
        <li><strong style="color:var(--text)">AES-GCM</strong> is authenticated encryption ‚Äî it detects tampering in addition to encrypting.</li>
        <li>Keys are stored as opaque <code>CryptoKey</code> objects; use <code>subtle.exportKey()</code> to serialise them.</li>
        <li>All <code>SubtleCrypto</code> methods return <strong style="color:var(--text)">Promises</strong> ‚Äî use <code>await</code> for clean code.</li>
      </ul>
    </div>
  </div>


  <div class="card">
    <div class="card-header"><span class="icon">üìö</span><h2>MDN Documentation</h2></div>
    <div class="card-body">
      <ul style="padding-left:20px;display:flex;flex-direction:column;gap:8px;font-size:0.9rem;">
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API" target="_blank" rel="noopener" style="color:var(--accent)">MDN: Web Crypto API</a></li>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto" target="_blank" rel="noopener" style="color:var(--accent)">MDN: SubtleCrypto</a></li>
      </ul>
    </div>
  </div>

</main>

<script>
  function genRandom() {
    const bytes = crypto.getRandomValues(new Uint8Array(16));
    const hex = Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join(' ');
    document.getElementById('randomOut').textContent = 'Hex: ' + hex;
  }

  function genUUID() {
    document.getElementById('randomOut').textContent = 'UUID: ' + crypto.randomUUID();
  }

  async function hashText() {
    const msg = document.getElementById('hashInput').value;
    const data = new TextEncoder().encode(msg);
    const buf = await crypto.subtle.digest('SHA-256', data);
    const hex = Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    document.getElementById('hashOut').textContent = 'SHA-256: ' + hex;
  }

  let cryptoKey = null, iv = null, lastCipher = null;

  async function encryptText() {
    const msg = document.getElementById('encInput').value;
    cryptoKey = await crypto.subtle.generateKey(
      { name: 'AES-GCM', length: 256 }, true, ['encrypt', 'decrypt']
    );
    iv = crypto.getRandomValues(new Uint8Array(12));
    const encoded = new TextEncoder().encode(msg);
    const cipher = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, cryptoKey, encoded);
    lastCipher = cipher;
    const b64 = btoa(String.fromCharCode(...new Uint8Array(cipher)));
    document.getElementById('encOut').textContent = 'Ciphertext (base64): ' + b64;
    document.getElementById('decOut').textContent = 'Press üîì Decrypt to recover the plaintext.';
  }

  async function decryptText() {
    if (!cryptoKey || !iv || !lastCipher) {
      document.getElementById('decOut').textContent = '‚ö†Ô∏è Encrypt something first!';
      return;
    }
    const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, cryptoKey, lastCipher);
    document.getElementById('decOut').textContent = 'üîì Decrypted: ' + new TextDecoder().decode(decrypted);
  }
</script>

<script src="random-nav.js" defer></script>
<script src="qr-badge.js" defer></script>
</body>
</html>
