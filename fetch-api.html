<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fetch API ‚Äî Web API Demos</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .result-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 16px;
      font-size: 0.9rem;
    }
    .user-card {
      display: flex; gap: 16px; align-items: flex-start;
    }
    .user-card img {
      width: 64px; height: 64px;
      border-radius: 50%;
      border: 2px solid var(--border);
      flex-shrink: 0;
    }
    .user-info h3 { font-size: 1rem; margin-bottom: 4px; }
    .user-info p { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 2px; }
    .post-item {
      border-bottom: 1px solid var(--border);
      padding: 12px 0;
    }
    .post-item:last-child { border-bottom: none; }
    .post-item h4 { font-size: 0.9rem; text-transform: capitalize; margin-bottom: 4px; }
    .post-item p  { font-size: 0.8rem; color: var(--text-muted); }
    .tab-bar { display:flex; gap:8px; flex-wrap:wrap; }
    .weather-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .weather-tile {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 12px;
      text-align: center;
      font-size: 0.8rem;
    }
    .weather-tile .big { font-size: 1.4rem; font-weight: 700; color: var(--accent); }
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="back-link">‚Üê Back to Index</a>
  <span class="nav-title">Fetch API</span>
</nav>

<div class="page-header">
  <span class="api-badge">Network</span>
  <h1>Fetch API</h1>
  <p>The modern, Promise-based replacement for <code>XMLHttpRequest</code>. Fetch data from REST APIs, stream responses, and handle errors ‚Äî all with clean, readable code.</p>
</div>

<main>

  <div class="card">
    <div class="card-header"><span class="icon">üåç</span><h2>Live Demo ‚Äî Public APIs</h2></div>
    <div class="demo-area">

      <div class="tab-bar">
        <button class="btn-primary" id="btn-users" onclick="showDemo('users')">üë§ Random User</button>
        <button class="btn-outline" id="btn-posts" onclick="showDemo('posts')">üìù Blog Posts</button>
        <button class="btn-outline" id="btn-weather" onclick="showDemo('weather')">üå§Ô∏è Weather</button>
        <button class="btn-outline" id="btn-custom" onclick="showDemo('custom')">üõ†Ô∏è Custom URL</button>
      </div>

      <!-- Users -->
      <div id="demo-users">
        <button class="btn-accent" onclick="fetchUser()">üîÄ Fetch Random User</button>
        <div id="userResult" class="result-card" style="display:none"></div>
      </div>

      <!-- Posts -->
      <div id="demo-posts" style="display:none">
        <div class="field-row">
          <label style="margin:0">User ID (1‚Äì10):</label>
          <input type="number" id="userId" min="1" max="10" value="1" style="width:80px">
          <button class="btn-primary" onclick="fetchPosts()">üì• Fetch Posts</button>
        </div>
        <div id="postsResult" style="display:none;max-height:300px;overflow-y:auto" class="result-card"></div>
      </div>

      <!-- Weather -->
      <div id="demo-weather" style="display:none">
        <p class="text-muted small">Using the open-meteo.com free weather API ‚Äî no key required!</p>
        <div class="field-row" style="flex-wrap:wrap">
          <div class="field">
            <label>Latitude</label>
            <input type="number" id="lat" value="39.7456" step="0.01" style="width:110px">
          </div>
          <div class="field">
            <label>Longitude</label>
            <input type="number" id="lon" value="-75.5466" step="0.01" style="width:110px">
          </div>
          <button class="btn-primary" style="align-self:flex-end" onclick="fetchWeather()">üå°Ô∏è Fetch Weather</button>
        </div>
        <div id="weatherResult" style="display:none" class="result-card"></div>
      </div>

      <!-- Custom -->
      <div id="demo-custom" style="display:none">
        <div class="field">
          <label>URL (must support CORS)</label>
          <div class="field-row">
            <input type="text" id="customUrl" value="https://jsonplaceholder.typicode.com/todos/1" style="flex:1">
            <button class="btn-primary" onclick="fetchCustom()">Fetch</button>
          </div>
        </div>
        <div id="customResult" style="display:none;max-height:300px;overflow-y:auto" class="result-card"></div>
      </div>

      <div class="status-box" id="status">Ready ‚Äî choose a demo above</div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><span class="icon">üíª</span><h2>Source Code</h2></div>
    <div class="code-block">
      <pre><code>// Basic GET request
const response = await fetch('https://api.example.com/data');
const data = await response.json();

// Check for HTTP errors (fetch only rejects on network failure)
if (!response.ok) {
  throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}

// POST with JSON body
const res = await fetch('/api/users', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'Alice', age: 30 }),
});
const created = await res.json();

// Stream a large response
const reader = response.body.getReader();
const decoder = new TextDecoder();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  console.log(decoder.decode(value)); // process chunk
}

// Abort a fetch with AbortController
const controller = new AbortController();
setTimeout(() => controller.abort(), 5000); // timeout after 5s
const data = await fetch(url, { signal: controller.signal });</code></pre>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><span class="icon">üí°</span><h2>Key Facts</h2></div>
    <div class="card-body">
      <ul style="padding-left:20px;display:flex;flex-direction:column;gap:8px;font-size:0.9rem;color:var(--text-muted)">
        <li><code>fetch()</code> returns a <strong style="color:var(--text)">Promise&lt;Response&gt;</strong>. It only rejects on <em>network</em> errors ‚Äî a 404 or 500 still resolves!</li>
        <li>Always check <code>response.ok</code> (true if status is 200‚Äì299) for proper error handling.</li>
        <li>Response bodies can be read as <code>.json()</code>, <code>.text()</code>, <code>.blob()</code>, <code>.arrayBuffer()</code>, or <code>.formData()</code>.</li>
        <li>Use <code>AbortController</code> to cancel in-flight requests and implement timeouts.</li>
        <li>Supports streaming responses via <code>response.body.getReader()</code> ‚Äî great for AI chat completions.</li>
      </ul>
    </div>
  </div>

</main>

<script>
  function showDemo(name) {
    ['users','posts','weather','custom'].forEach(d => {
      document.getElementById('demo-'+d).style.display = d===name ? '' : 'none';
      document.getElementById('btn-'+d).className = d===name ? 'btn-primary' : 'btn-outline';
    });
  }

  function setStatus(msg, type='') {
    const s = document.getElementById('status');
    s.textContent = msg;
    s.style.color = type === 'error' ? 'var(--danger)' : type === 'ok' ? 'var(--success)' : 'var(--accent)';
  }

  async function fetchUser() {
    setStatus('Fetching‚Ä¶');
    try {
      const res = await fetch('https://randomuser.me/api/');
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      const u = data.results[0];
      const el = document.getElementById('userResult');
      el.style.display = '';
      el.innerHTML = `<div class="user-card">
        <img src="${u.picture.large}" alt="avatar">
        <div class="user-info">
          <h3>${u.name.first} ${u.name.last}</h3>
          <p>üìß ${u.email}</p>
          <p>üìç ${u.location.city}, ${u.location.country}</p>
          <p>üìÖ Age ${u.dob.age}</p>
        </div>
      </div>`;
      setStatus(`‚úì Loaded user in ${res.headers.get('content-type')}`, 'ok');
    } catch(e) { setStatus('Error: ' + e.message, 'error'); }
  }

  async function fetchPosts() {
    const uid = document.getElementById('userId').value;
    setStatus('Fetching posts‚Ä¶');
    try {
      const res = await fetch(`https://jsonplaceholder.typicode.com/posts?userId=${uid}&_limit=5`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const posts = await res.json();
      const el = document.getElementById('postsResult');
      el.style.display = '';
      el.innerHTML = posts.map(p => `<div class="post-item">
        <h4>${p.title}</h4>
        <p>${p.body}</p>
      </div>`).join('');
      setStatus(`‚úì Loaded ${posts.length} posts for user ${uid}`, 'ok');
    } catch(e) { setStatus('Error: ' + e.message, 'error'); }
  }

  async function fetchWeather() {
    const lat = document.getElementById('lat').value;
    const lon = document.getElementById('lon').value;
    setStatus('Fetching weather‚Ä¶');
    try {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation_probability&forecast_days=1`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      const cw = data.current_weather;
      const temps = data.hourly.temperature_2m.slice(0,6);
      const el = document.getElementById('weatherResult');
      el.style.display = '';
      el.innerHTML = `<p style="margin-bottom:10px"><strong>Current:</strong> ${cw.temperature}¬∞C, Wind ${cw.windspeed} km/h, Code ${cw.weathercode}</p>
      <div class="weather-grid">
        ${temps.map((t,i) => `<div class="weather-tile"><div class="big">${t}¬∞</div><div>${i}:00</div></div>`).join('')}
      </div>`;
      setStatus(`‚úì Weather for (${parseFloat(lat).toFixed(2)}, ${parseFloat(lon).toFixed(2)})`, 'ok');
    } catch(e) { setStatus('Error: ' + e.message, 'error'); }
  }

  async function fetchCustom() {
    const url = document.getElementById('customUrl').value.trim();
    if (!url) return;
    setStatus('Fetching‚Ä¶');
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      let formatted;
      try { formatted = JSON.stringify(JSON.parse(text), null, 2); } catch { formatted = text; }
      const el = document.getElementById('customResult');
      el.style.display = '';
      el.innerHTML = `<pre style="white-space:pre-wrap;font-size:0.8rem;font-family:monospace">${escapeHtml(formatted.slice(0,2000))}</pre>`;
      setStatus(`‚úì ${res.status} ${res.statusText} ‚Äî ${res.headers.get('content-type')}`, 'ok');
    } catch(e) { setStatus('Error: ' + e.message, 'error'); }
  }

  function escapeHtml(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
</script>

</body>
</html>
